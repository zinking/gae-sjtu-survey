<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="400" height="300">

<mx:Script>
		<![CDATA[
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import com.adobe.cairngorm.control.CairngormEvent;
			import net.isurvey.event.RegisterEvent;
			import net.isurvey.model.*;
			import mx.rpc.*;
			import mx.rpc.events.*;
			import mx.controls.*;
			import mx.events.ValidationResultEvent;
			
		private function getUser():UserData{
			var user:UserData = new UserData();
			user.name = username.text;
			user.password = password.text;
			
			return user;
			
		}
			
		
		private function register(event:Event):void
		{
			var usr:UserData = getUser();
			
		    var evt:RegisterEvent = new RegisterEvent(usr);
			CairngormEventDispatcher.getInstance().dispatchEvent( evt );
					
		}
		
			
		private function validate(event:Event):void
		{
			var vru:ValidationResultEvent = validUsr.validate();
			var vrp:ValidationResultEvent = validPassword.validate();
			var vrsp:ValidationResultEvent = validSamePassword.validate();
			
			if ( vru.type == ValidationResultEvent.VALID 
					&& vrp.type == ValidationResultEvent.VALID
					&& vrsp.type == ValidationResultEvent.VALID 
					&& password.text == samepassword.text){ 
				submit.enabled = true;
			}
			else{
				submit.enabled = false;
			}
		}
				]]>
	</mx:Script>


<!-- 客户端校验器部分-->
	<mx:StringValidator id="validUsr" source="{username}"
		property="text" minLength="2" maxLength="12"/>					
    <mx:StringValidator id="validPassword" source="{password}"	
    	property="text" minLength="4" maxLength="12"/>
    <mx:StringValidator id="validSamePassword" source="{samepassword}"	
    	property="text" minLength="4" maxLength="12"/>
    	
	<mx:Form x="0" y="0" width="100%" height="100%">
		<mx:FormItem label="*请选择您的用户名：" horizontalAlign="left">
			<mx:TextInput id="username" 
			change="validate(event)" />
		</mx:FormItem>
		
		<mx:FormItem>
			<mx:Label text="不超过7个汉字，或14个字节(数字，字母和下划线)"/>
		</mx:FormItem>
		
		<mx:FormItem label="*请输入您的密码：">
			<mx:TextInput id="password"
			change="validate(event)" displayAsPassword="true" />
		</mx:FormItem>
		
		<mx:FormItem>
			<mx:Label text="长度必须最少包含8个字符，字母区分大小写。"/>
		</mx:FormItem>
		
		<mx:FormItem label="*请再次输入您的密码：">
			<mx:TextInput id="samepassword"
				change="validate(event)" displayAsPassword="true" />
		</mx:FormItem>
		
		<mx:FormItem label="*请输入您的邮箱：">
			<mx:TextInput/>
		</mx:FormItem>
		
		<mx:FormItem>
			<mx:Label text="请输入有效的邮件地址，当密码遗失时凭此领取。"/>
		</mx:FormItem>
		
		<mx:FormItem label="姓名：">
			<mx:TextInput/>
		</mx:FormItem>
		
		<mx:FormItem label="性别">
			<mx:HBox width="100%">
				<mx:RadioButton label="男"/>
				<mx:Spacer height="100%" width="20"/>
				<mx:RadioButton label="女"/>
			</mx:HBox>
		</mx:FormItem>
		
		<mx:FormItem>
			<mx:HBox width="100%">
				<mx:Button label="确定" id="submit"
					enabled="true" click = "register(event)"/>
				<mx:Spacer height="100%" width="20"/>
				<mx:Button label="取消"/>
			</mx:HBox>
		</mx:FormItem>
		
	</mx:Form>
	
</mx:Module>
