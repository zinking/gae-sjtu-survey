<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="350" height="400"
	 initialize="init()">
<mx:Script>
	<![CDATA[
		import mx.events.ValidationResultEvent;
		import mx.controls.RadioButton;
		import net.isurvey.model.*;
		
		public var  questiondata:QuestionData = new QuestionData();
		public var isValidQuestion:Boolean = false;
		
		public function init():void{
			rdBox.removeAllChildren();
			renderQuestionData( questiondata );
		}
		
		public function renderQuestionData( questiondata:QuestionData ):void{
			txtQuestionDescription.text = questiondata.description  ;
			rdBox.removeAllChildren();
			for each ( var item:Object in questiondata.optionlist ){
				var rb:TextInput = new TextInput();
				rb.text = item.description;
				rdBox.addChild( rb );
			}						
		}
		
		public function getQuestionData():QuestionData{
			questiondata.description = txtQuestionDescription.text;
			questiondata.optionlist.removeAll();
			for each ( var item:TextInput in rdBox.getChildren() ){
				var optionitem:Object = new Object();
				optionitem.optionname = item.text;
				optionitem.pollcount = 0;
				questiondata.optionlist.addItem( optionitem );
			}						
			return questiondata;
		}

		private function onAddOption( event:Event):void{
			var rdOption:TextInput = new TextInput();
			rdOption.text = txtOptionDescription.text;
			rdBox.addChild( rdOption );
			txtOptionDescription.text = "";
		}
		
		private function validateCreatedQuestion( event:Event ):void{
			if ( rdBox.getChildren().length < 2 ) {
				rdBox.errorString = "请至少输入两个选项";
				return;
			}
			else{
				rdBox.errorString = "";
			}
			isValidQuestion = true;
			this.dispatchEvent( new Event("ENABLE_ADD_QUESTION"));
		}
		
		private function validate( event:Event ):void{
			this.label = txtQuestionDescription.text;
			var pdvr:ValidationResultEvent = vdProblemDescription.validate();
			var odvr:ValidationResultEvent = vdOptionDescription.validate();
			if ( pdvr.type == ValidationResultEvent.VALID &&
				 odvr.type == ValidationResultEvent.VALID ) btnAddOption.enabled = true;
			else {
				btnAddOption.enabled = false;
				return;
			}
			
		}
		
		
	]]>
</mx:Script>


	<mx:StringValidator id="vdProblemDescription"  source="{txtQuestionDescription}" property="text"
		minLength="1"  maxLength="50"/>
	<mx:StringValidator id="vdOptionDescription"  source="{txtOptionDescription}" property="text"
		minLength="1"  maxLength="50"/>
	<mx:StringValidator />
	<mx:VDividedBox width="95%" height="95%" left="10" top="10" verticalGap="10" liveDragging="false">
   		<mx:Form height="194" width="100%" >
   			<mx:FormHeading label="问题描述" 
   				width="100%" textAlign="left" height="22" fontWeight="normal" textDecoration="normal"/>
			<mx:Canvas width="100%" height="68">
				<mx:TextArea   id="txtQuestionDescription" width="100%" height="100%"
					 change="validate(event)"/>
			</mx:Canvas>
		
			<mx:FormItem label="问题类型" width="100%" fontSize="14" horizontalAlign="left" required="true">
				<mx:HBox height="100%" width="100%">
					<mx:Spacer width="10%"/>
					<mx:RadioButton  label="单选" selected="true"/>
					<mx:RadioButton  label="多选" enabled="false"/>
				</mx:HBox>
			</mx:FormItem>
		
			<mx:FormItem label="选项描述" width="100%" fontSize="14" horizontalAlign="left" required="true">
				<mx:TextInput id="txtOptionDescription" width="100%"
					change="validate(event)"/>
			</mx:FormItem>
		</mx:Form>
	
		<mx:Canvas label="Label" height="171" width="100%">			
			<mx:Button id="btnAddOption" label="添加问题选项" right="230" y="10" enabled="false"
				click="onAddOption(event)"/>
			<mx:VBox id="rdBox" 
				width="100%" height="100%" horizontalAlign="center" 
				verticalAlign="middle" enabled="true" visible="true">
				<mx:RadioButton label="Radio1"/>
				<mx:RadioButton label="Radio2"/>	
			</mx:VBox>
			<mx:Button label="确认问题" x="262" y="127" enabled="true"  visible="true"
				 click="validateCreatedQuestion(event)"/>
		</mx:Canvas>
	</mx:VDividedBox>
	
	
</mx:Canvas>
