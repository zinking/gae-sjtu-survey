<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%"
	 xmlns:Util="component.Util.*" xmlns:Survey="component.SurveyUI.*" xmlns:User="component.UserUI.*"
	  creationComplete="init()" xmlns:ns1="*">
	 <mx:Script>
	 	<![CDATA[

	 		import net.isurvey.model.*;
	 		import net.isurvey.event.*;
	 		import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import com.adobe.cairngorm.control.CairngormEvent;
	 		
	 		private var modelLocator:SurveyModelLocator = SurveyModelLocator.getInstance();
	 		
	 		
	 		private function init():void{
	 			modelLocator.bodyloader = mdLoader;
	 			modelLocator.controlpanel = cpanel;
	 			loadSettings();	 			
	 		}
	 		private function loadModule( moduleurl:String):void{
				mdLoader.unloadModule();
				mdLoader.url = moduleurl;
	 			mdLoader.loadModule();
			} 
			private function arrangeUserUI( type:int ):void{
				switch( type ){
					case UserData.ADMIN:
					leftbox.removeChild( anonymousLogin );
	 				modelLocator.controlpanel_status = ControlPanelEvent.MANAGE_SURVEY;
	 				cpanel.currentState = 'admin';
	 				break;
	 				case UserData.USER:
	 				leftbox.removeChild(anonymousLogin);
	 				modelLocator.controlpanel_status = ControlPanelEvent.VIEW_SURVEY;
	 				cpanel.currentState = 'user';
	 				break;
	 				case UserData.ANONYMOUS:
	 				leftbox.removeChild(cpanel);
	 				modelLocator.controlpanel_status = ControlPanelEvent.VIEW_SURVEY;
	 				break;
	 				default:
	 				trace("MAIN FRAME ARRANGE UI FAILED");
	 				
				}
			}
			
	 			 		
	 		public function loadSettings():void{
	 			var currentUser:UserData = modelLocator.user;
	 			arrangeUserUI( currentUser.type);

	 			var evt:ControlPanelEvent;
	 			evt = new ControlPanelEvent( modelLocator.controlpanel_status);	 			
				CairngormEventDispatcher.getInstance().dispatchEvent( evt );
	 		}
	 		
	 		
	 		
	 	]]>
	 </mx:Script>

	<mx:Style source="styles/mainmodulestyle.css"/>
	
	<mx:Box width="100%" height="100%" horizontalAlign="center">
		

	<mx:VBox id="header" height="15%">
<!--		<mx:Image  source="@Embed(source='images/2.1.JPG')" 
			left="0" top="0" width="100%" scaleContent="true"  
			useHandCursor="true" maintainAspectRatio="false"/>-->
		<mx:Image  source="@Embed(source='images/2.jpg')" 
			scaleContent="true"  top="0" horizontalCenter="0" width="100%" maintainAspectRatio="false"
			useHandCursor="true" />		
		<Util:TitleBar id="topBar" horizontalCenter="0" top="183"/>
		<mx:Label text="Online Survey" fontSize="36" fontWeight="bold" color="#FFFFFF" top="122" left="181"/>	
	</mx:VBox>
	
	<mx:HBox id="body" height="70%">
		<mx:Spacer width="5%"/>
		<mx:VBox id="leftbox" width="20%" x="35" y="241">
			<User:AccountRender id="anonymousLogin" left="150" top="255" height="235"/>
			<User:ControlPanel  id="cpanel" left="150" top="505" width="230" height="250"/>
		</mx:VBox>
		
		<mx:ModuleLoader id="mdLoader"   horizontalCenter="0" top="255" width="55%" height="100%"/>
		
		<mx:VBox id="rightbox" right="18" top="255" width="20%">
			<Util:Calendar />
			<Util:Update/>
		</mx:VBox>		
	</mx:HBox>
	<mx:Box id="footer" height="15%">
			<mx:Label text="Design by WangZhen ChenYao ZhangYanLei LinQinQin and ZhangZhiYong " 
		horizontalCenter="0" color="#00FFFF" bottom="40"/>
	</mx:Box>

	</mx:Box>	
	


	
	



	

		

	
	
	
</mx:Module>
